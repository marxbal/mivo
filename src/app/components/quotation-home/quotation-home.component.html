<div class="row" id="quotationHome">
  <div class="col-xl-12">
    <div class="page-header">
      <h4 class="all-caps">
        <span class="fa-stack fa-md">
          <i class="fa fa-circle fa-stack-2x"></i>
          <i class="fa fa-home fa-stack-1x fa-inverse"></i>
        </span>
        {{pageLabel}}
      </h4>
    </div>
    <!-- .page-header -->
  </div>
  <!-- .col-xl-12 -->

  <div class="col-lg-12">
    <img class="product-img-banner" src="./assets/images/banner/home.jpg" alt="credits to freepik @stories" />
  </div>

  <div class="col-xl-12">
    <div class="card shadow">
      <div class="card-body">
        <form [formGroup]="quoteForm">

          <div *ngIf='isIssuance' class="card shadow mb-3">
            <div class="card-header">
              <strong>Individual Policy</strong>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-xl-12">
                  <div class="alert alert-info note">
                    <p><strong>Important Reminder:</strong> You need to have an approved quotation to proceed issuing a policy.</p>
                  </div>
                  <!-- .note -->
                </div>
                <div class="col-lg-12">
                  <div class="input-group">
                    <div class="input-group-prepend">
                      <label class="input-group-text" for="quotationNumber">Quotation Number</label>
                    </div>
                    <input type="text" class="form-control" placeholder="Enter Quotation Number here.."
                      formControlName="quotationNumber" [(ngModel)]="homeDetails.quotationNumber">
                    <div class="input-group-append">
                      <button [disabled]="disableLoadBtn" class="btn btn-outline-secondary" (click)="loadQuotation()"
                        type="button">Load</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="card shadow mb-3">
            <div class="card-header">
              <strong>Risk Details</strong>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['subline'].invalid 
                    && (quoteForm.controls['subline'].dirty 
                    || quoteForm.controls['subline'].touched)}">
                    <label for="subline">Business Line</label>
                    <select class="custom-select mr-sm-2 required" formControlName="subline"
                      [(ngModel)]="homeDetails.subline" [attr.disabled]="true">
                      <option *ngFor="let subline of LOV.sublineLOV" [ngValue]="subline.COD_RAMO">
                        {{ subline.NOM_RAMO }}</option>
                    </select>
                    <p class="form-error" *ngIf="quoteForm.controls['subline'].errors?.required">
                      * business line is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['currency'].invalid 
                  && (quoteForm.controls['currency'].dirty 
                  || quoteForm.controls['currency'].touched)}">
                    <label for="currency">Currency</label>
                    <select class="custom-select mr-sm-2 required" formControlName="currency"
                      [(ngModel)]="homeDetails.currency" [attr.disabled]="true">
                      <option selected></option>
                      <option *ngFor="let currency of LOV.currencyLOV" [ngValue]="currency.COD_MON">
                        {{ currency.NOM_MON }}
                      </option>
                    </select>
                    <p class="form-error" *ngIf="quoteForm.controls['currency'].errors?.required">
                      * currency is required
                    </p>
                  </div>
                </div>

                <div class="form-divider"></div>
                <div class="col-xl-12">
                  <h6>Location of Risk</h6>
                </div>

                <div *ngIf="isIssuance" class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['district'].invalid 
                  && (quoteForm.controls['district'].dirty 
                  || quoteForm.controls['district'].touched)}">
                    <label for="district">District</label>
                    <select class="custom-select mr-sm-2 required" formControlName="district"
                      [(ngModel)]="homeDetails.district" (change)="getBlockNumber()"
                      [attr.disabled]="editMode ? null : true">
                      <option selected></option>
                      <option *ngFor="let district of LOV.districtLOV" [ngValue]="district.NUM_DISTRICT">
                        {{ district.NUM_DISTRICT }}
                      </option>
                    </select>
                    <p class="form-error" *ngIf="quoteForm.controls['district'].errors?.required">
                      * district is required
                    </p>
                  </div>
                </div>

                <div *ngIf="isIssuance" class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['blockNumber'].invalid 
                  && (quoteForm.controls['blockNumber'].dirty 
                  || quoteForm.controls['blockNumber'].touched)}">
                    <label for="blockNumber">Block Number</label>
                    <select class="custom-select mr-sm-2 required" formControlName="blockNumber"
                      [(ngModel)]="homeDetails.blockNumber"
                      [attr.disabled]="editMode ? null : true">
                      <option selected></option>
                      <option *ngFor="let blockNumber of LOV.blockNumberLOV" [ngValue]="blockNumber.NUM_BLOCK">
                        {{ blockNumber.NUM_BLOCK }}
                      </option>
                    </select>
                    <p class="form-error" *ngIf="quoteForm.controls['blockNumber'].errors?.required">
                      * block number is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['buildingNumber'].invalid 
                  && (quoteForm.controls['buildingNumber'].dirty 
                  || quoteForm.controls['buildingNumber'].touched)}">
                    <label for="buildingNumber">House/Building Number</label>
                    <input type="text" formControlName="buildingNumber" class="form-control"
                      [(ngModel)]="homeDetails.buildingNumber"
                      oninput="this.value = this.value.toUpperCase()"
                      [attr.disabled]="editMode ? null : true">
                    <p class="form-error" *ngIf="quoteForm.controls['buildingNumber'].errors?.required">
                      * building number is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-12">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['subdivision'].invalid 
                  && (quoteForm.controls['subdivision'].dirty 
                  || quoteForm.controls['subdivision'].touched)}">
                    <label for="subdivision">Village/Subdivision</label>
                    <input type="text" formControlName="subdivision" class="form-control"
                      [(ngModel)]="homeDetails.subdivision"
                      oninput="this.value = this.value.toUpperCase()"
                      [attr.disabled]="editMode ? null : true">
                    <p class="form-error" *ngIf="quoteForm.controls['subdivision'].errors?.required">
                      * subdivision is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-12">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['buildingName'].invalid 
                  && (quoteForm.controls['buildingName'].dirty 
                  || quoteForm.controls['buildingName'].touched)}">
                    <label for="buildingName">Building Name</label>
                    <input type="text" formControlName="buildingName" class="form-control"
                      [(ngModel)]="homeDetails.buildingName"
                      oninput="this.value = this.value.toUpperCase()"
                      [attr.disabled]="editMode ? null : true">
                    <p class="form-error" *ngIf="quoteForm.controls['buildingName'].errors?.required">
                      * building name is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-12">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['streetName'].invalid 
                  && (quoteForm.controls['streetName'].dirty 
                  || quoteForm.controls['streetName'].touched)}">
                    <label for="streetName">Street Name</label>
                    <input type="text" formControlName="streetName" class="form-control"
                      [(ngModel)]="homeDetails.streetName"
                      oninput="this.value = this.value.toUpperCase()"
                      [attr.disabled]="editMode ? null : true">
                    <p class="form-error" *ngIf="quoteForm.controls['streetName'].errors?.required">
                      * street name is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['barangay'].invalid 
                  && (quoteForm.controls['barangay'].dirty 
                  || quoteForm.controls['barangay'].touched)}">
                    <label for="barangay">Barangay</label>
                    <input type="text" formControlName="barangay" class="form-control"
                      [(ngModel)]="homeDetails.barangay"
                      oninput="this.value = this.value.toUpperCase()"
                      [attr.disabled]="editMode ? null : true">
                    <p class="form-error" *ngIf="quoteForm.controls['barangay'].errors?.required">
                      * barangay is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['region'].invalid 
                  && (quoteForm.controls['region'].dirty 
                  || quoteForm.controls['region'].touched)}">
                    <label for="region">Region</label>
                    <select class="custom-select mr-sm-2 required" formControlName="region"
                      [(ngModel)]="homeDetails.region" (change)="getProvince()"
                      [attr.disabled]="editMode ? null : true">
                      <option selected></option>
                      <option *ngFor="let region of LOV.regionLOV" [ngValue]="region.COD_ESTADO">
                        {{ region.NOM_ESTADO }}</option>
                    </select>
                    <p class="form-error" *ngIf="quoteForm.controls['region'].errors?.required">
                      * region is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['province'].invalid 
                  && (quoteForm.controls['province'].dirty 
                  || quoteForm.controls['province'].touched)}">
                    <label for="province">Province</label>
                    <select class="custom-select mr-sm-2 required" formControlName="province"
                      [(ngModel)]="homeDetails.province" (change)="getCity()"
                      [attr.disabled]="editMode ? null : true">
                      <option selected></option>
                      <option *ngFor="let province of LOV.provinceLOV" [ngValue]="province.COD_PROV">
                        {{ province.NOM_PROV }}</option>
                    </select>
                    <p class="form-error" *ngIf="quoteForm.controls['province'].errors?.required">
                      * province is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['city'].invalid 
                  && (quoteForm.controls['city'].dirty 
                  || quoteForm.controls['city'].touched)}">
                    <label for="city">City</label>
                    <select class="custom-select mr-sm-2 required" formControlName="city"
                      [(ngModel)]="homeDetails.city" (change)="getZipCode()"
                      [attr.disabled]="editMode ? null : true">
                      <option selected></option>
                      <option *ngFor="let city of LOV.cityLOV" [ngValue]="city.COD_LOCALIDAD">
                        {{ city.NOM_LOCALIDAD }}
                      </option>
                    </select>
                    <p class="form-error" *ngIf="quoteForm.controls['city'].errors?.required">
                      * city is required
                    </p>
                  </div>
                </div>
                <div class="clearfix"></div>
              </div>
            </div>
          </div>

          <div class="card shadow mb-3">
            <div class="card-header">
              <strong>Building / Content Details</strong>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-xl-12">
                  <h6>Building/Content</h6>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['buildingCapital'].invalid 
                  && (quoteForm.controls['buildingCapital'].dirty 
                  || quoteForm.controls['buildingCapital'].touched)}">
                    <label for="buildingCapital">Building Capital</label>
                    <input type="number" formControlName="buildingCapital" class="form-control required" 
                      [(ngModel)]="homeDetails.buildingCapital"
                      (change)="affecting('buildingCapital', 'Building Capital')"
                      [attr.disabled]="editMode ? null : true">
                    <p class="form-error" *ngIf="quoteForm.controls['buildingCapital'].errors?.required">
                      * building capital is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group">
                    <label for="contentValue">Content Value</label>
                    <input type="number" formControlName="contentValue" class="form-control"
                      (change)="affecting('contentValue', 'Content Value')"
                      [(ngModel)]="homeDetails.contentValue"
                      [attr.disabled]="editMode ? null : true">
                  </div>
                </div>

                <div *ngIf="isIssuance" class="col-lg-12">
                  <div class="form-group">
                    <label for="buildingContent">Content</label>
                    <textarea type="text" formControlName="buildingContent" class="form-control"
                      [(ngModel)]="homeDetails.buildingContent"
                      oninput="this.value = this.value.toUpperCase()"
                      [attr.disabled]="editMode ? null : true"></textarea>
                  </div>
                </div>

                <div class="form-divider"></div>
                <div class="col-xl-12">
                  <h6>Additional Details</h6>
                </div>

                <div class="col-lg-12">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['constructionOfBuilding'].invalid 
                  && (quoteForm.controls['constructionOfBuilding'].dirty 
                  || quoteForm.controls['constructionOfBuilding'].touched)}">
                    <label for="constructionOfBuilding">Construction of Building</label>
                    <textarea type="text" formControlName="constructionOfBuilding" class="form-control required"
                      [(ngModel)]="homeDetails.constructionOfBuilding"
                      oninput="this.value = this.value.toUpperCase()"
                      [attr.disabled]="editMode ? null : true"></textarea>
                    <p class="form-error" *ngIf="quoteForm.controls['constructionOfBuilding'].errors?.required">
                      * construction of building required
                    </p>
                  </div>
                </div>

                <div class="col-lg-12">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['occupancyOfBuilding'].invalid 
                  && (quoteForm.controls['occupancyOfBuilding'].dirty 
                  || quoteForm.controls['occupancyOfBuilding'].touched)}">
                    <label for="occupancyOfBuilding">Occupancy of Building</label>
                    <textarea type="text" formControlName="occupancyOfBuilding" class="form-control required"
                      [(ngModel)]="homeDetails.occupancyOfBuilding"
                      oninput="this.value = this.value.toUpperCase()"
                      [attr.disabled]="editMode ? null : true"></textarea>
                    <p class="form-error" *ngIf="quoteForm.controls['occupancyOfBuilding'].errors?.required">
                      * occupancy of building is required
                    </p>
                  </div>
                </div>

                <div class="form-divider"></div>
                <div class="col-xl-12">
                  <h6>Boundaries</h6>
                </div>

                <div class="col-lg-12">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['front'].invalid 
                  && (quoteForm.controls['front'].dirty 
                  || quoteForm.controls['front'].touched)}">
                    <label for="front">Front</label>
                    <textarea type="text" formControlName="front" class="form-control required"
                      [(ngModel)]="homeDetails.front"
                      oninput="this.value = this.value.toUpperCase()"
                      [attr.disabled]="editMode ? null : true"></textarea>
                    <p class="form-error" *ngIf="quoteForm.controls['front'].errors?.required">
                      * front is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-12">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['right'].invalid 
                  && (quoteForm.controls['right'].dirty 
                  || quoteForm.controls['right'].touched)}">
                    <label for="right">Right</label>
                    <textarea type="text" formControlName="right" class="form-control required"
                      [(ngModel)]="homeDetails.right"
                      oninput="this.value = this.value.toUpperCase()"
                      [attr.disabled]="editMode ? null : true"></textarea>
                    <p class="form-error" *ngIf="quoteForm.controls['right'].errors?.required">
                      * right is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-12">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['left'].invalid 
                  && (quoteForm.controls['left'].dirty 
                  || quoteForm.controls['left'].touched)}">
                    <label for="left">Left</label>
                    <textarea type="text" formControlName="left" class="form-control required"
                      [(ngModel)]="homeDetails.left"
                      oninput="this.value = this.value.toUpperCase()"
                      [attr.disabled]="editMode ? null : true"></textarea>
                    <p class="form-error" *ngIf="quoteForm.controls['left'].errors?.required">
                      * left is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-12">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['rear'].invalid 
                  && (quoteForm.controls['rear'].dirty 
                  || quoteForm.controls['rear'].touched)}">
                    <label for="rear">Rear</label>
                    <textarea type="text" formControlName="rear" class="form-control required"
                      [(ngModel)]="homeDetails.rear"
                      oninput="this.value = this.value.toUpperCase()"
                      [attr.disabled]="editMode ? null : true"></textarea>
                    <p class="form-error" *ngIf="quoteForm.controls['rear'].errors?.required">
                      * rear is required
                    </p>
                  </div>
                </div>
              </div>

            </div>
          </div>

          <div class="card shadow mb-3">
            <div class="card-header d-flex justify-content-between optional"
              (click)="showImprovement = !showImprovement" matTooltip="click to show/hide improvement details">
              <strong>Improvement Details</strong>
              <div class="dropdown no-arrow">
                <i class="fas fa-angle-double-down fa-sm fa-fw text-gray-400"></i>
              </div>
            </div>
            <div class="card-body" *ngIf="showImprovement">
              <div class="row">

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['improvement'].invalid 
                  && (quoteForm.controls['improvement'].dirty 
                  || quoteForm.controls['improvement'].touched)}">
                    <label for="improvement">Improvement</label>
                    <input type="number" formControlName="improvement" class="form-control"
                      [(ngModel)]="homeDetails.improvement"
                      (change)="affecting('improvement', 'Improvement')"
                      [attr.disabled]="editMode ? null : true">
                    <p class="form-error" *ngIf="quoteForm.controls['improvement'].errors?.min">
                      * should be higher than 0
                    </p>
                  </div>
                </div>

              </div>
            </div>
          </div>

          <div class="card shadow mb-3">
            <div class="card-header d-flex justify-content-between optional"
              (click)="showRelatedStructure = !showRelatedStructure"
              matTooltip="click to show/hide other related structure details">
              <strong>Other Related Structure Details</strong>
              <div class="dropdown no-arrow">
                <i class="fas fa-angle-double-down fa-sm fa-fw text-gray-400"></i>
              </div>
            </div>
            <div class="card-body" *ngIf="showRelatedStructure">

              <div class="row" formArrayName="relatedStructure">
                <div class="col-lg-3 col-md-4 col-sm-6"
                  *ngFor="let item of quoteForm.get('relatedStructure')['controls']; let i=index">
                  <div class="form-group" [formGroupName]="i" [ngClass]="{'input-error': item.controls['_value'].invalid 
                  && (item.controls['_value'].dirty 
                  || item.controls['_value'].touched)}">
                    <label>{{item.get('_name').value}}</label>
                    <input type="number" class="form-control" formControlName="_value" [attr.disabled]="editMode ? null : true">
                    <p class="form-error" *ngIf="item.controls['_value'].errors?.min">
                      * should be higher than 0
                    </p>
                  </div>
                </div>
              </div>

            </div>
          </div>

          <div class="card shadow mb-3">
            <div class="card-header d-flex justify-content-between optional"
              (click)="showRelatedContent = !showRelatedContent"
              matTooltip="click to show/hide other related content details">
              <strong>Other Related Content Details</strong>
              <div class="dropdown no-arrow">
                <i class="fas fa-angle-double-down fa-sm fa-fw text-gray-400"></i>
              </div>
            </div>
            <div class="card-body" *ngIf="showRelatedContent">

              <div class="row" formArrayName="relatedContent">
                <div class="col-lg-3 col-md-4 col-sm-6"
                  *ngFor="let item of quoteForm.get('relatedContent')['controls']; let i=index">
                  <div class="form-group" [formGroupName]="i" [ngClass]="{'input-error': item.controls['_value'].invalid 
                  && (item.controls['_value'].dirty 
                  || item.controls['_value'].touched)}">
                    <label>{{item.get('_name').value}}</label>
                    <input type="number" class="form-control" formControlName="_value" [attr.disabled]="editMode ? null : true">
                    <p class="form-error" *ngIf="item.controls['_value'].errors?.min">
                      * should be higher than 0
                    </p>
                  </div>
                </div>
              </div>

            </div>
          </div>

          <app-group-policy 
            #appGroupPolicy
            [subline]="homeDetails.subline"
            [prevDetails]="prevHomeDetails"
            [groupPolicy]="groupPolicy"
            [editMode]="editMode"
            [showExpiring]="true"
            [(changedValues)]="changedValues"
            [loadQuotation]="triggerCounter">
          </app-group-policy>

          <div class="card shadow mb-3">
            <div class="card-header">
              <strong>General Information</strong>
            </div>

            <div class="card-body">
              <div class="row">
                <div class="col-xl-12">
                  <h6>Movement Dates</h6>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['effectivityDate'].invalid 
                    && (quoteForm.controls['effectivityDate'].dirty 
                    || quoteForm.controls['effectivityDate'].touched)}">
                    <label for="effectivityDate">Effectivity Date</label>
                    <input type="text" placeholder="Datepicker" class="form-control required"
                      (bsValueChange)="affecting('effectivityDate', 'Effectivity Date')"
                      formControlName="effectivityDate" [(ngModel)]="homeDetails.effectivityDate"
                      [attr.disabled]="editMode ? null : true" bsDatepicker>
                    <p class="form-error" *ngIf="quoteForm.controls['effectivityDate'].errors?.required">
                      * effectivity date is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['expiryDate'].invalid 
                    && (quoteForm.controls['expiryDate'].dirty 
                    || quoteForm.controls['expiryDate'].touched)}">
                    <label for="expiryDate">Expiry Date</label>
                    <input type="text" placeholder="Datepicker" class="form-control required"
                      [minDate]="expiryDateMinDate" (bsValueChange)="affecting('expiryDate', 'Expirty Date')"
                      formControlName="expiryDate" [(ngModel)]="homeDetails.expiryDate"
                      [attr.disabled]="editMode ? null : true" bsDatepicker>
                    <p class="form-error" *ngIf="quoteForm.controls['expiryDate'].errors?.required">
                      * expiry date is required
                    </p>
                  </div>
                </div>
              </div>

            </div>
          </div>

          <app-policy-holder #appPolicyHolder
            [title]="'Policy Holder Information'"
            [showCreateBtn]="true"
            [details]="homeDetails"
            [(policyHolder)]="policyHolder"
            [isIssuance]="isIssuance" 
            [editMode]="editMode"
            [type]="'primary'"
            [optional]="false" 
            [loadQuotation]="triggerCounter">
          </app-policy-holder>

          <app-policy-holder
            *ngIf="isIssuance"
            [title]="'Alternative Policy Holder (Optional)'"
            [showCreateBtn]="true"
            [details]="homeDetails"
            [(policyHolder)]="secondaryPolicyHolder"
            [isIssuance]="isIssuance"
            [editMode]="editMode"
            [type]="'secondary'"
            [optional]="true"
            [showPrefix]="false">
          </app-policy-holder>

          <div class="card shadow mb-3" *ngIf="isIssuance">
            <div class="card-header d-flex justify-content-between">
              <strong>Additional Policy Information</strong>
              <div class="dropdown no-arrow">
                <i class="fas fa-angle-double-down fa-sm fa-fw text-gray-400"></i>
              </div>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-xl-12">
                  <h6>Additional Details for Location of Risk</h6>
                </div>

                <div class="col-xl-12">
                  <div class="row">

                    <div class="col-lg-3 col-md-4 col-sm-6">
                      <div class="form-group">
                        <label for="crestaZone">Cresta Zone</label>
                        <input type="number" formControlName="crestaZone" class="form-control"
                          [(ngModel)]="homeDetails.crestaZone"
                          [attr.disabled]="true">
                      </div>
                    </div>

                    <div class="col-lg-3 col-md-4 col-sm-6">
                      <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['zipCode'].invalid 
                        && (quoteForm.controls['zipCode'].dirty 
                        || quoteForm.controls['zipCode'].touched)}">
                        <label for="zipCode">Zip Code</label>
                        <select class="custom-select mr-sm-2 required" formControlName="zipCode"
                          [(ngModel)]="homeDetails.zipCode" [attr.disabled]="editMode ? null : true">
                          <option selected></option>
                          <option *ngFor="let zipCode of LOV.zipCodeLOV" [ngValue]="zipCode.COD_POSTAL">
                            {{ zipCode.COD_POSTAL }}
                          </option>
                        </select>
                        <p class="form-error" *ngIf="quoteForm.controls['zipCode'].errors?.required">
                          * zip code is required
                        </p>
                      </div>
                    </div>

                  </div>
                </div>
              </div>

              <div class="form-divider"></div>

              <div class="row">
                <div class="col-xl-12">
                  <div class="alert alert-info note">
                    <p><strong>Important Reminder:</strong> Please provide mortgagee details if you selected <strong>Mortgagee</strong>.
                    </p>
                  </div>
                  <!-- .note -->
                </div>

                <div class="col-xl-12">
                  <h6>Mortgagee</h6>
                </div>

                <div class="col-xl-12">
                  <div class="row">

                    <div class="col-lg-3 col-md-4 col-sm-6">
                      <div class="form-group">
                        <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="cbMortgagee"
                            [(ngModel)]="homeDetails.cbMortgagee" formControlName="cbMortgagee"
                            (change)="showMortgagee = !showMortgagee" [attr.disabled]="editMode ? null : true">
                          <label class="form-check-label" for="cbMortgagee">
                            Mortgagee
                          </label>
                        </div>
                      </div>
                    </div>

                  </div>
                </div>
              </div>

            </div>
          </div>

          <app-policy-holder
            *ngIf="isIssuance && showMortgagee"
            [title]="'Mortgagee Policy Holder Information'"
            [showCreateBtn]="false"
            [details]="homeDetails"
            [(policyHolder)]="mortgageePolicyHolder"
            [isIssuance]="isIssuance"
            [editMode]="editMode"
            [type]="'mortgagee'"
            [optional]="false">
          </app-policy-holder>

          <div class="card shadow mb-3" *ngIf="showRatePercentage">
            <div class="card-header d-flex justify-content-between">
              <strong>Rate Percentage</strong>
              <div class="dropdown no-arrow">
                <i class="fas fa-angle-double-down fa-sm fa-fw text-gray-400"></i>
              </div>
            </div>
            <div class="card-body">
              <div class="row">

                <div class="col-xl-12">
                  <div class="alert alert-info note">
                    <p><strong>Important Reminder:</strong> Rate should be modified <strong>higher</strong> than the original rate.
                    </p>
                  </div>
                  <!-- .note -->
                </div>

                <div class="col-xl-12">
                  <div class="row">

                    <div class="col-lg-3 col-md-4 col-sm-6">
                      <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['ratePercentage'].invalid 
                      && (quoteForm.controls['ratePercentage'].dirty 
                      || quoteForm.controls['ratePercentage'].touched)}">
                        <label for="ratePercentage">Rate Percentage</label>
                        <input type="number" formControlName="ratePercentage" class="form-control"
                          [(ngModel)]="homeDetails.ratePercentage"
                          [attr.disabled]="editMode ? null : true"
                          (change)="affecting('ratePercentage', 'Rate Percentage')">
                          <p class="form-error" *ngIf="quoteForm.controls['ratePercentage'].errors?.required">
                            * rate percentage is required
                          </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>

          <div class="card shadow mb-3" *ngIf="isIssuance">
            <div class="card-header d-flex justify-content-between">
              <strong>Warranted No Loss</strong>
              <div class="dropdown no-arrow">
                <i class="fas fa-angle-double-down fa-sm fa-fw text-gray-400"></i>
              </div>
            </div>
            <div class="card-body">
              <div class="row">

                <div class="col-xl-12">
                  <div class="row">

                    <div class="col-lg-3 col-md-4 col-sm-6">
                      <div class="form-group">
                        <label for="warrantedNoLoss">Warranted No Loss</label>
                        <input type="number" formControlName="warrantedNoLoss" class="form-control"
                          [(ngModel)]="homeDetails.warrantedNoLoss"
                          [attr.disabled]="editMode ? null : true">
                      </div>
                    </div>

                  </div>
                </div>
              </div>

            </div>
          </div>

          <app-payment-breakdown
            *ngIf="showPaymentBreakdown"
            #appPaymentBreakdown
            [paymentReceipt]="paymentReceipt"
            [paymentBreakdown]="paymentBreakdown"
            [showExchangeRate]="false"
            [loadBreakdown]="triggerBreakdown">
          </app-payment-breakdown>

          <app-fixed-coverages
            *ngIf="showCoverage"
            [line]="'home'"
            [coverageList]="coverageList"
            [loadCoverage]="triggerCoverage">
          </app-fixed-coverages>

          <div class="card shadow mb-3">
            <div class="card-header">
              <strong>Product</strong>
            </div>

            <div class="card-body">
              <div class="row">
                <div class="col-xl-12">
                  <h6>Product Data</h6>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['paymentMethod'].invalid 
                    && (quoteForm.controls['paymentMethod'].dirty 
                    || quoteForm.controls['paymentMethod'].touched)}">
                    <label for="paymentMethod">Payment Method</label>
                    <select class="custom-select mr-sm-2 required" formControlName="paymentMethod"
                      [(ngModel)]="homeDetails.paymentMethod"
                      [attr.disabled]="editMode && LOV.paymentMethodLOV?.length ? null : true">
                      <option *ngFor="let paymentMethod of LOV.paymentMethodLOV"
                        [ngValue]="paymentMethod.COD_FRACC_PAGO">
                        {{ paymentMethod.NOM_FRACC_PAGO }}</option>
                    </select>
                    <p class="form-error" *ngIf="quoteForm.controls['paymentMethod'].errors?.required">
                      * payment method is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['product'].invalid 
                    && (quoteForm.controls['product'].dirty 
                    || quoteForm.controls['product'].touched)}">
                    <label for="product">Product List</label>
                    <select class="custom-select mr-sm-2 required" formControlName="product"
                      [(ngModel)]="homeDetails.product"
                      [attr.disabled]="editMode && LOV.productListLOV?.length ? null : true">
                      <option *ngFor="let product of LOV.productListLOV" [ngValue]="product.COD_MODALIDAD">
                        {{ product.NOM_MODALIDAD }}
                      </option>
                    </select>
                    <p class="form-error" *ngIf="quoteForm.controls['product'].errors?.required">
                      * product list is required
                    </p>
                  </div>
                </div>

              </div>
            </div>
          </div>

          <!-- button controls for quotation -->
          <div *ngIf="!isIssuance">
            <div *ngIf="showGenerateBtn" class="btn-group" role="group">
              <button *ngIf="quoteForm.invalid || appGroupPolicy.gpForm.invalid || appPolicyHolder.phForm.invalid"
                type="button" class="btn btn-primary"
                (click)="openValidationModal(quoteForm, appGroupPolicy.gpForm, appPolicyHolder.phForm)">Generate</button>
              <button *ngIf="!quoteForm.invalid && !appGroupPolicy.gpForm.invalid && !appPolicyHolder.phForm.invalid"
                type="button" class="btn btn-primary" (click)="proceed(1)">Generate</button>
            </div>
            <div *ngIf="showIssueQuoteBtn" class="btn-group" role="group">
              <button *ngIf="!editMode" type="button" class="btn btn-primary" (click)="manageBtn(1)">Edit
                Details</button>
              <button *ngIf="quoteForm.invalid || appGroupPolicy.gpForm.invalid || appPolicyHolder.phForm.invalid"
                type="button" class="btn btn-primary"
                (click)="openValidationModal(quoteForm, appGroupPolicy.gpForm, appPolicyHolder.phForm)">Issue
                Quote</button>
              <button *ngIf="!quoteForm.invalid && !appGroupPolicy.gpForm.invalid && !appPolicyHolder.phForm.invalid"
                type="button" class="btn btn-primary" (click)="proceed(2)">Issue Quote</button>
            </div>
            <div *ngIf="showProceedToIssuanceBtn" class="text-right">
              <h5><small>Your quotation number:</small> {{homeDetails.quotationNumber}}</h5>
            </div>
            <div *ngIf="showProceedToIssuanceBtn" class="btn-group" role="group">
              <button type="button" (click)="newQuote()" class="btn btn-primary">New Quote</button>
              <button type="button" (click)="printQuote()" class="btn btn-primary">Print Quote</button>
              <button type="button" (click)="proceedToIssuance()" class="btn btn-primary">Proceed to Issuance</button>
            </div>
          </div>

          <!-- button controls for issuance -->
          <div *ngIf="isIssuance">
            <!-- <div *ngIf="showIssuanceGenerateBtn" class="btn-group" role="group">
              <button *ngIf="quoteForm.invalid || appGroupPolicy.gpForm.invalid || appPolicyHolder.phForm.invalid"
                type="button" class="btn btn-primary"
                [disabled]="!editMode"
                (click)="openValidationModal(quoteForm, appGroupPolicy.gpForm, appPolicyHolder.phForm)">Generate</button>
              <button *ngIf="!quoteForm.invalid && !appGroupPolicy.gpForm.invalid && !appPolicyHolder.phForm.invalid"
                type="button" class="btn btn-primary" (click)="proceed(1)">Generate</button>
            </div> -->
            <div *ngIf="(showSaveBtn && withTechControl) || (showPostBtn && withTechControl)">
              <div class="alert alert-warning note">
                <p>
                  <strong>Quotation has tech control!</strong> Unable to issue policy.
                </p>
              </div>
              <!-- .note -->
              <div class="btn-group" role="group">
                <button type="button" class="btn btn-primary" (click)="newQuote()">New Quote</button>
                <button type="button" class="btn btn-primary" (click)="newPolicy()">New Policy</button>
              </div>
            </div>

            <div *ngIf="showNewPolicyBtn">
              <div class="alert alert-danger note">
                <p>
                  <strong>Quotation has error!</strong> Unable to issue policy.
                </p>
              </div>
              <!-- .note -->
              <div class="btn-group" role="group">
                <button type="button" class="btn btn-primary" (click)="newQuote()">New Quote</button>
                <button type="button" class="btn btn-primary" (click)="newPolicy()">New Policy</button>
              </div>
            </div>

            <div *ngIf="showSaveBtn && !withTechControl" class="btn-group" role="group">
              <button *ngIf="!editMode" type="button" class="btn btn-primary" (click)="manageBtn(1)">Edit
                Details</button>
              <button *ngIf="quoteForm.invalid || appGroupPolicy.gpForm.invalid || appPolicyHolder.phForm.invalid"
                type="button" class="btn btn-primary"
                (click)="openValidationModal(quoteForm, appGroupPolicy.gpForm, appPolicyHolder.phForm)">Save</button>
              <button *ngIf="!quoteForm.invalid && !appGroupPolicy.gpForm.invalid && !appPolicyHolder.phForm.invalid"
                type="button" class="btn btn-primary" (click)="proceed(3)">Save</button>
            </div>

            <div *ngIf="showPostBtn && !withTechControl" class="btn-group" role="group">
              <button *ngIf="!editMode" type="button" class="btn btn-primary" (click)="editMode = !editMode">Edit
                Details</button>
              <button *ngIf="quoteForm.invalid || appGroupPolicy.gpForm.invalid || appPolicyHolder.phForm.invalid"
                type="button" class="btn btn-primary"
                (click)="openValidationModal(quoteForm, appGroupPolicy.gpForm, appPolicyHolder.phForm)">Post</button>
              <button *ngIf="!quoteForm.invalid && !appGroupPolicy.gpForm.invalid && !appPolicyHolder.phForm.invalid"
                type="button" class="btn btn-primary" (click)="proceed(4)">Post</button>
            </div>

            <div *ngIf="showPrintBtn" class="text-right">
              <h5><small>Your policy number:</small> {{homeDetails.policyNumber}}</h5>
            </div>
            <div *ngIf="showPrintBtn" class="btn-group" role="group">
              <button type="button" class="btn btn-primary" (click)="newPolicy()">New Policy</button>
              <button type="button" class="btn btn-primary" (click)="printPolicy()">Print</button>
            </div>
          </div>

        </form>
        <!-- .quote-form -->
      </div>
      <!-- .card-body -->
    </div>
    <!-- .card.shadow -->
  </div>
  <!-- .col-xl-12 -->
</div>
<!-- #quotationHome -->

<ng-template #proceedModal let-data>
  <div class="mat-dialog-header border-bottom">
    <div class="header row">
      <div class="col-md-12">
        <h4>Are you sure you want to proceed?</h4>
      </div>
    </div>
  </div>
  <mat-dialog-content>
    <br>
    <h6>You have changes to this following field/s: </h6>
    <ul>
      <li *ngFor="let item of changedValues">
        {{item}}
      </li>

      <li *ngIf="hasRSChanges">
        Other Related Structure Details
      </li>

      <li *ngIf="hasRCChanges">
        Other Related Content Details
      </li>
    </ul>
    <h6>Changes may affect your premium and will create a new quotation.</h6>
  </mat-dialog-content>
  <div mat-dialog-actions align="end">
    <div class="btn-group" role="group">
      <button type="button" class="btn btn-primary" matDialogClose>
        Cancel
      </button>
      <button *ngIf="data.generateBtn" type="button" class="btn btn-primary" matDialogClose (click)="issueQuote('S')">
        Generate
      </button>
      <button *ngIf="data.saveBtn" type="button" class="btn btn-primary" matDialogClose (click)="savePolicy()">
        Save
      </button>
    </div>
  </div>
</ng-template>

<ng-template #validationModal let-data>
  <div class="mat-dialog-header border-bottom">
    <div class="header row">
      <div class="col-md-12">
        <h4>Your application is incomplete</h4>
      </div>
    </div>
  </div>
  <mat-dialog-content>
    <br>
    <h6>You have invalid/empty data to this following field/s: </h6>
    <ul>
      <li *ngFor="let item of invalidForms">
        {{item}}
      </li>
    </ul>
  </mat-dialog-content>
  <div mat-dialog-actions align="end">
    <div class="btn-group" role="group">
      <button type="button" class="btn btn-primary" matDialogClose>
        Okay
      </button>
    </div>
  </div>
</ng-template>