<div class="row" id="quotationCar">
  <div class="col-xl-12">
    <div class="page-header">
      <h4 class="all-caps">
        <span class="fa-stack fa-md">
          <i class="fa fa-circle fa-stack-2x"></i>
          <i class="fa fa-car fa-stack-1x fa-inverse"></i>
        </span>
        {{pageLabel}}
      </h4>
    </div>
    <!-- .page-header -->
  </div>
  <!-- .col-xl-12 -->

  <div class="col-lg-12">
    <img class="product-img-banner" src="./assets/images/banner-car.jpg" alt="credits to freepik @stories" />
  </div>

  <div class="col-xl-12">
    <div class="card shadow">
      <div class="card-body" id="topDiv">
        <form [formGroup]="quoteForm" class="regular-quote-form">

          <div *ngIf='isIssuance' class="card shadow mb-3">
            <div class="card-header">
              <strong>Individual Policy</strong>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-lg-12">
                  <div class="input-group">
                    <div class="input-group-prepend">
                      <label class="input-group-text" for="inputGroupSelect01">Quotation Number</label>
                    </div>
                    <input type="text" class="form-control" placeholder="Enter Quotation Number here.."
                      formControlName="quotationNumber" [(ngModel)]="carDetails.quotationNumber">
                    <div class="input-group-append">
                      <button [disabled]="disableLoadBtn" class="btn btn-outline-secondary" (click)="loadQuotation()"
                        type="button">Load</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="card shadow mb-3">
            <div class="card-header">
              <strong>Vehicle Information</strong>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-xl-12">
                  <h6>Risk Details</h6>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['make'].invalid 
                    && (quoteForm.controls['make'].dirty 
                    || quoteForm.controls['make'].touched)}">
                    <label for="make">Make</label>
                    <select class="custom-select mr-sm-2 required" formControlName="make" (change)="makeOnchange()"
                      [(ngModel)]="carDetails.make">
                      <option *ngFor="let make of LOV.makeLOV" [ngValue]="make.COD_MARCA">{{ make.NOM_MARCA }}</option>
                    </select>
                    <p class="form-error" *ngIf="quoteForm.controls['make'].errors?.required">
                      * make is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['model'].invalid 
                  && (quoteForm.controls['model'].dirty 
                  || quoteForm.controls['model'].touched)}">
                    <label for="model">Model</label>
                    <select class="custom-select mr-sm-2 required" formControlName="model" (change)="modelOnchange()"
                      [(ngModel)]="carDetails.model" [attr.disabled]=" LOV.modelLOV?.length ? null : true">
                      <option selected></option>
                      <option *ngFor="let model of LOV.modelLOV" [ngValue]="model.COD_MODELO">{{ model.NOM_MODELO }}
                      </option>
                    </select>
                    <p class="form-error" *ngIf="quoteForm.controls['model'].errors?.required">
                      * model is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['vehicleType'].invalid 
                  && (quoteForm.controls['vehicleType'].dirty 
                  || quoteForm.controls['vehicleType'].touched)}">
                    <label for="vehicleType">Vehicle Type</label>
                    <select class="custom-select mr-sm-2 required" formControlName="vehicleType"
                      (change)="vehicleTypeOnchange()" [(ngModel)]="carDetails.vehicleType"
                      [attr.disabled]=" LOV.vehicleTypeLOV?.length ? null : true">
                      <option selected></option>
                      <option *ngFor="let vehicleType of LOV.vehicleTypeLOV" [ngValue]="vehicleType.COD_TIP_VEHI">
                        {{ vehicleType.NOM_TIP_VEHI }}</option>
                    </select>
                    <p class="form-error" *ngIf="quoteForm.controls['vehicleType'].errors?.required">
                      * vehicle type is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['modelYear'].invalid 
                  && (quoteForm.controls['modelYear'].dirty 
                  || quoteForm.controls['modelYear'].touched)}">
                    <label for="modelYear">Model Year</label>
                    <select class="custom-select mr-sm-2 required" formControlName="modelYear"
                      (change)="modelYearOnchange()" [(ngModel)]="carDetails.modelYear"
                      [attr.disabled]=" LOV.modelYearLOV?.length ? null : true">
                      <option selected></option>
                      <option *ngFor="let modelYear of LOV.modelYearLOV" [ngValue]="modelYear.ANIO_SUB_MODELO">
                        {{ modelYear.ANIO_SUB_MODELO }}</option>
                    </select>
                    <p class="form-error" *ngIf="quoteForm.controls['modelYear'].errors?.required">
                      * model year is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['subModel'].invalid 
                  && (quoteForm.controls['subModel'].dirty 
                  || quoteForm.controls['subModel'].touched)}">
                    <label for="subModel">Sub Model</label>
                    <select class="custom-select mr-sm-2 required" formControlName="subModel"
                      (change)="subModelOnchange()" [(ngModel)]="carDetails.subModel"
                      [attr.disabled]=" LOV.subModelLOV?.length ? null : true">
                      <option selected></option>
                      <option *ngFor="let subModel of LOV.subModelLOV" [ngValue]="subModel.COD_SUB_MODELO">
                        {{subModel.NOM_SUB_MODELO + '('+ subModel.TIP_CAJA_CAMBIO+ ') '+ (subModel.NOM_TRACCION == 'UNKNOWN' ? "": subModel.NOM_TRACCION)}}
                      </option>
                    </select>
                    <p class="form-error" *ngIf="quoteForm.controls['subModel'].errors?.required">
                      * sub model is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['typeOfUse'].invalid 
                  && (quoteForm.controls['typeOfUse'].dirty 
                  || quoteForm.controls['typeOfUse'].touched)}">
                    <label for="typeOfUse">Type of Use</label>
                    <select class="custom-select mr-sm-2 required" formControlName="typeOfUse"
                      (change)="typeOfUseOnchange()" [(ngModel)]="carDetails.typeOfUse"
                      [attr.disabled]=" LOV.typeOfUseLOV?.length ? null : true">
                      <option selected></option>
                      <option *ngFor="let typeOfUse of LOV.typeOfUseLOV" [ngValue]="typeOfUse.COD_USO_VEHI">
                        {{ typeOfUse.NOM_USO_VEHI }}</option>
                    </select>
                    <p class="form-error" *ngIf="quoteForm.controls['typeOfUse'].errors?.required">
                      * type of use is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['subline'].invalid 
                  && (quoteForm.controls['subline'].dirty 
                  || quoteForm.controls['subline'].touched)}">
                    <label for="subline">Subline</label>
                    <select class="custom-select mr-sm-2 required" formControlName="subline"
                      (change)="sublineOnchange($event)" [(ngModel)]="carDetails.subline"
                      [attr.disabled]=" LOV.sublineLOV?.length ? null : true">
                      <option selected></option>
                      <option *ngFor="let subline of LOV.sublineLOV" [ngValue]="subline.value"
                        [attr.data-sublinedate]="subline.effectivityDate">{{ subline.name }}
                      </option>
                    </select>
                    <p class="form-error" *ngIf="quoteForm.controls['subline'].errors?.required">
                      * subline is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['vehicleValue'].invalid 
                  && (quoteForm.controls['vehicleValue'].dirty 
                  || quoteForm.controls['vehicleValue'].touched)}">
                    <label for="vehicleValue">Vehicle Value</label>
                    <input type="text" formControlName="vehicleValue" class="form-control"
                      [(ngModel)]="carDetails.vehicleValue">
                    <p class="form-error" *ngIf="quoteForm.controls['vehicleValue'].errors?.required">
                      * vehicle value is required
                    </p>
                  </div>
                </div>
                <div class="clearfix"></div>

                <div class="form-divider"></div>
                <div class="col-xl-12">
                  <h6>Vehicle Information</h6>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['color'].invalid 
                    && (quoteForm.controls['color'].dirty 
                    || quoteForm.controls['color'].touched)}">
                    <label for="color">Color</label>
                    <select class="custom-select mr-sm-2 required" formControlName="color"
                      [(ngModel)]="carDetails.color">
                      <option *ngFor="let color of LOV.colorLOV" [ngValue]="color.COD_COLOR">{{ color.NOM_COLOR }}
                      </option>
                    </select>
                    <p class="form-error" *ngIf="quoteForm.controls['color'].errors?.required">
                      * color is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['areaOfUsage'].invalid 
                    && (quoteForm.controls['areaOfUsage'].dirty 
                    || quoteForm.controls['areaOfUsage'].touched)}">
                    <label for="areaOfUsage">Area of Usage</label>
                    <select class="custom-select mr-sm-2 required" formControlName="areaOfUsage"
                      [(ngModel)]="carDetails.areaOfUsage" [attr.disabled]=" LOV.areaOfUsageLOV?.length ? null : true">
                      <option *ngFor="let areaOfUsage of LOV.areaOfUsageLOV" [ngValue]="areaOfUsage.COD_VALOR">
                        {{ areaOfUsage.NOM_VALOR }}</option>
                    </select>
                    <p class="form-error" *ngIf="quoteForm.controls['areaOfUsage'].errors?.required">
                      * area of usage is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['conductionNumber'].invalid 
                  && (quoteForm.controls['conductionNumber'].dirty 
                  || quoteForm.controls['conductionNumber'].touched)}">
                    <label for="conductionNumber">Conduction Number</label>
                    <input type="text" formControlName="conductionNumber" class="form-control" [ngClass]="{'required' : carDetails.plateNumber === undefined
                      || carDetails.plateNumber === null
                      || carDetails.plateNumber === ''}" [(ngModel)]="carDetails.conductionNumber"
                      oninput="this.value = this.value.toUpperCase()">
                    <p class="form-error" *ngIf="quoteForm.controls['conductionNumber'].errors?.required">
                      * conduction number is required
                    </p>
                    <p class="form-error"
                      *ngIf="quoteForm.controls['conductionNumber'].errors?.invalidConductionNumber">
                      * conduction number is invalid
                    </p>
                  </div>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['plateNumber'].invalid 
                  && (quoteForm.controls['plateNumber'].dirty 
                  || quoteForm.controls['plateNumber'].touched)}">
                    <label for="plateNumber">Plate Number</label>
                    <input type="text" formControlName="plateNumber" class="form-control"
                      [attr.disabled]=" (LOV.sublineLOV?.length && LOV.modelYearLOV?.length) ? null : true" [ngClass]="{'required' : carDetails.conductionNumber === undefined
                      || carDetails.conductionNumber === null
                      || carDetails.conductionNumber === ''}" [(ngModel)]="carDetails.plateNumber"
                      oninput="this.value = this.value.toUpperCase()">
                    <p class="form-error" *ngIf="quoteForm.controls['plateNumber'].errors?.required">
                      * plate number is required
                    </p>
                    <p class="form-error" *ngIf="quoteForm.controls['plateNumber'].errors?.invalidPlateNumber">
                      * plate number is invalid
                    </p>
                  </div>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['serialNumber'].invalid 
                  && (quoteForm.controls['serialNumber'].dirty 
                  || quoteForm.controls['serialNumber'].touched)}">
                    <label for="serialNumber">Chassis Number/Serial Number</label>
                    <input type="text" formControlName="serialNumber" class="form-control required"
                      [(ngModel)]="carDetails.serialNumber"
                      oninput="this.value = this.value.toUpperCase()">
                    <p class="form-error" *ngIf="quoteForm.controls['serialNumber'].errors?.required">
                      * serial number is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['engineNumber'].invalid 
                  && (quoteForm.controls['engineNumber'].dirty 
                  || quoteForm.controls['engineNumber'].touched)}">
                    <label for="engineNumber">Motor Number/Engine Number</label>
                    <input type="text" formControlName="engineNumber" class="form-control required"
                      [(ngModel)]="carDetails.engineNumber"
                      oninput="this.value = this.value.toUpperCase()">
                    <p class="form-error" *ngIf="quoteForm.controls['engineNumber'].errors?.required">
                      * engine number is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group">
                    <label for="mvFileNumber">MV File Number</label>
                    <input type="text" formControlName="mvFileNumber" class="form-control"
                      [(ngModel)]="carDetails.mvFileNumber"
                      oninput="this.value = this.value.toUpperCase()">
                  </div>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['purchaseDate'].invalid 
                      && (quoteForm.controls['purchaseDate'].dirty 
                      || quoteForm.controls['purchaseDate'].touched)}">
                    <label for="purchaseDate">Purchase Date</label>
                    <input type="text" placeholder="Datepicker" class="form-control required" [minDate]="today"
                      formControlName="purchaseDate" [(ngModel)]="carDetails.purchaseDate" bsDatepicker>
                    <p class="form-error" *ngIf="quoteForm.controls['purchaseDate'].errors?.required">
                      * purchase date is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['receivedBy'].invalid 
                  && (quoteForm.controls['receivedBy'].dirty 
                  || quoteForm.controls['receivedBy'].touched)}">
                    <label for="receivedBy">Received By</label>
                    <input type="text" formControlName="receivedBy" class="form-control required"
                      [(ngModel)]="carDetails.receivedBy">
                    <p class="form-error" *ngIf="quoteForm.controls['receivedBy'].errors?.required">
                      * received by is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['receivedDate'].invalid 
                      && (quoteForm.controls['receivedDate'].dirty 
                      || quoteForm.controls['receivedDate'].touched)}">
                    <label for="receivedDate">Received Date</label>
                    <input type="text" placeholder="Datepicker" class="form-control required" [minDate]="today"
                      formControlName="receivedDate" [(ngModel)]="carDetails.receivedDate" bsDatepicker>
                    <p class="form-error" *ngIf="quoteForm.controls['receivedDate'].errors?.required">
                      * received date is required
                    </p>
                  </div>
                </div>

              </div>
            </div>
          </div>

          <app-policy-holder
            #appPolicyHolder
            [title]="'Policy Holder Information'"
            [showCreateBtn]="true"
            [details]="carDetails"
            [(policyHolder)]="policyHolder"
            [compareTo]="assigneePolicyHolder"
            [isIssuance]="isIssuance"
            [type]="'primary'"
            [optional]="false">
          </app-policy-holder>

          <app-policy-holder
            *ngIf="isIssuance"
            [title]="'Alternative Policy Holder (Optional)'"
            [showCreateBtn]="true"
            [details]="carDetails"
            [(policyHolder)]="secondaryPolicyHolder"
            [isIssuance]="isIssuance"
            [type]="'secondary'"
            [optional]="true">
          </app-policy-holder>

          <app-group-policy
            #appGroupPolicy
            [subline]="carDetails.subline"
            [details]="carDetails"
            [groupPolicy]="groupPolicy">
          </app-group-policy>

          <div class="card shadow mb-3">
            <div class="card-header">
              <strong>General Information</strong>
            </div>

            <div class="card-body">
              <div class="row">
                <div class="col-xl-12">
                  <h6>Movement Dates</h6>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['effectivityDate'].invalid 
                    && (quoteForm.controls['effectivityDate'].dirty 
                    || quoteForm.controls['effectivityDate'].touched)}">
                    <label for="effectivityDate">Effectivity Date</label>
                    <input type="text" placeholder="Datepicker" class="form-control required" [minDate]="today"
                      (bsValueChange)="effectivityDateOnChange()" formControlName="effectivityDate"
                      [(ngModel)]="carDetails.effectivityDate" bsDatepicker>
                    <p class="form-error" *ngIf="quoteForm.controls['effectivityDate'].errors?.required">
                      * effectivity date is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['expiryDate'].invalid 
                    && (quoteForm.controls['expiryDate'].dirty 
                    || quoteForm.controls['expiryDate'].touched)}">
                    <label for="expiryDate">Expiry Date</label>
                    <input type="text" placeholder="Datepicker" class="form-control required"
                      [minDate]="expiryDateMinDate" formControlName="expiryDate" [(ngModel)]="carDetails.expiryDate"
                      bsDatepicker>
                    <p class="form-error" *ngIf="quoteForm.controls['expiryDate'].errors?.required">
                      * expiry date is required
                    </p>
                  </div>
                </div>
              </div>

            </div>
          </div>

          <div class="card shadow mb-3">
            <div class="card-header d-flex justify-content-between optional"
              (click)="showAccessories = !showAccessories" matTooltip="click to show/hide accessories">
              <strong>Accessories (Optional)</strong>
              <div class="dropdown no-arrow">
                <i class="fas fa-angle-double-down fa-sm fa-fw text-gray-400"></i>
              </div>
            </div>
            <div class="card-body" *ngIf="showAccessories">

              <div formArrayName="accessories">
                <div *ngFor="let accessories of quoteForm.get('accessories')['controls']; let i=index">
                  <div [formGroupName]="i" class="card accessory-card">
                    <div class="card-body">
                      <div class="row">
                        <div class="col-lg-10 col-md-9">
                          <div class="row">
                            <div class="col-md-4">
                              <div class="form-group" [ngClass]="{'input-error': accessories.controls['accessory'].invalid 
                                && (accessories.controls['accessory'].dirty 
                                || accessories.controls['accessory'].touched)}">
                                <label for="accessory">Accessory List</label>
                                <select class="custom-select mr-sm-2 required" formControlName="accessory"
                                  (change)="accessoryOnchange($event, i)">
                                  <option *ngFor="let accessoryList of LOV.accessoryListLOV"
                                    [ngValue]="accessoryList.COD_ACCESORIO"
                                    [attr.disabled]="accessoryList.disabled ? '' : null"
                                    [attr.data-price]="accessoryList.IMP_ACCESORIO"
                                    [attr.data-type]="accessoryList.ABR_AGRUP_ACCESORIO">
                                    {{ accessoryList.NOM_ACCESORIO }}
                                    ( {{ 
                                      accessoryList.ABR_AGRUP_ACCESORIO == 'A' ? 'Additional' :
                                      accessoryList.ABR_AGRUP_ACCESORIO == 'B' ? 'Built-in' : 'Free'
                                    }} )</option>
                                </select>
                                <p class="form-error" *ngIf="accessories.controls['accessory'].errors?.required">
                                  * accessory list is required
                                </p>
                              </div>
                            </div>

                            <div class="col-md-4">
                              <div class="form-group" [ngClass]="{'input-error': accessories.controls['accessoryType'].invalid 
                                && (accessories.controls['accessoryType'].dirty 
                                || accessories.controls['accessoryType'].touched)}">
                                <label for="accessoryType">Accessory Type</label>
                                <input type="text" formControlName="accessoryType" class="form-control required"
                                  readonly>
                                <p class="form-error" *ngIf="accessories.controls['accessoryType'].errors?.required">
                                  * accessory type is required
                                </p>
                              </div>
                            </div>

                            <div class="col-md-4">
                              <div class="form-group" [ngClass]="{'input-error': accessories.controls['price'].invalid 
                                && (accessories.controls['price'].dirty 
                                || accessories.controls['price'].touched)}">
                                <label for="price">Price</label>
                                <input type="number" class="form-control required" formControlName="price">
                                <p class="form-error" *ngIf="accessories.controls['price'].errors?.required">
                                  * price is required
                                </p>
                              </div>
                            </div>

                            <div class="col-md-12">
                              <div class="form-group" [ngClass]="{'input-error': accessories.controls['description'].invalid 
                                && (accessories.controls['description'].dirty 
                                || accessories.controls['description'].touched)}">
                                <label for="description">Description</label>
                                <textarea type="text" formControlName="description"
                                  class="form-control required"></textarea>
                                <p class="form-error" *ngIf="accessories.controls['description'].errors?.required">
                                  * description is required
                                </p>
                              </div>
                            </div>
                          </div>
                        </div>

                        <div class="col-lg-2 col-md-3">
                          <div class="btn-group">
                            <button class="btn btn-primary" (click)="removeAccessory(i)">Remove</button>
                          </div>
                        </div>

                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="btn-group">
                <button [disabled]="quoteForm.get('accessories').status !== 'VALID' || !carDetails.subline"
                  type="button" (click)="addAccessory()" class="btn btn-primary">Add Accessory</button>
              </div>

            </div>
          </div>

          <div class="card shadow mb-3">
            <div class="card-header d-flex justify-content-between optional"
              (click)="showAdditionalInformation = !showAdditionalInformation"
              matTooltip="click to show/hide additional policy information">
              <strong>Additional Policy Information (Optional)</strong>
              <div class="dropdown no-arrow">
                <i class="fas fa-angle-double-down fa-sm fa-fw text-gray-400"></i>
              </div>
            </div>
            <div class="card-body" *ngIf="showAdditionalInformation">
              <div class="row">
                <div class="col-xl-12">
                  <h6>Additional Vehicle Information</h6>
                </div>

                <div class="col-lg-9">
                  <div class="form-group">
                    <label for="customRiskName">Custom Risk Name</label>
                    <input type="text" class="form-control" [(ngModel)]="carDetails.customRiskName"
                      formControlName="customRiskName" readonly>
                  </div>
                </div>

                <div class="clearfix"></div>

                <div class="col-md-3">
                  <div class="form-group">
                    <label for="seatingCapacity">Seating Capacity</label>
                    <input type="number" class="form-control" [(ngModel)]="carDetails.seatingCapacity"
                      formControlName="seatingCapacity">
                  </div>
                </div>

                <div class="col-md-3">
                  <div class="form-group">
                    <label for="weight">Weight</label>
                    <input type="text" class="form-control" [(ngModel)]="carDetails.weight" formControlName="weight"
                      readonly>
                  </div>
                </div>

                <div class="col-md-3">
                  <div class="form-group">
                    <label for="displacement">Displacement</label>
                    <input type="text" class="form-control" [(ngModel)]="carDetails.displacement"
                      formControlName="displacement" readonly>
                  </div>
                </div>

                <div class="col-md-3">
                  <div class="form-group">
                    <label for="classification">Classification</label>
                    <select class="custom-select mr-sm-2" formControlName="classification"
                      [(ngModel)]="carDetails.classification">
                      <option selected></option>
                      <option *ngFor="let classification of LOV.classificationLOV"
                        [ngValue]="classification.TIP_VEHI_PESO">{{ classification.NOM_VALOR }}</option>
                    </select>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="form-group">
                    <label for="price">Coverage Area</label>
                    <select class="custom-select mr-sm-2" formControlName="coverageArea"
                      [(ngModel)]="carDetails.coverageArea">
                      <option selected></option>
                      <option *ngFor="let coverageArea of LOV.coverageAreaLOV" [ngValue]="coverageArea.COD_AREA_COVER">
                        {{ coverageArea.NOM_VALOR }}</option>
                    </select>
                  </div>
                </div>

                <div class="col-md-3">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['assuredsCoinsuranceShare'].invalid 
                  && (quoteForm.controls['assuredsCoinsuranceShare'].dirty 
                  || quoteForm.controls['assuredsCoinsuranceShare'].touched)}">
                    <label for="assuredCoinsuranceShare">Assured's Coinsurance Share</label>
                    <input type="number" class="form-control" [(ngModel)]="carDetails.assuredsCoinsuranceShare"
                      formControlName="assuredsCoinsuranceShare">
                    <p class="form-error" *ngIf="quoteForm.controls['assuredsCoinsuranceShare'].errors?.max">
                      * assured's coinsurance share max value is 100
                    </p>
                  </div>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group">
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="cbWaivedMinPremium"
                        [(ngModel)]="carDetails.cbWaivedMinPremium" formControlName="cbWaivedMinPremium">
                      <label class="form-check-label" for="cbWaivedMinPremium">
                        Waived Min. Premium
                      </label>
                    </div>
                  </div>
                </div>

                <div *ngIf="isIssuance" class="col-xl-12">
                  <div class="row">

                    <div class="form-divider"></div>

                    <div class="col-lg-3 col-md-4 col-sm-6">
                      <div class="form-group">
                        <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="cbPolicyOnlyDriver"
                            [(ngModel)]="carDetails.cbPolicyOnlyDriver" formControlName="cbPolicyOnlyDriver">
                          <label class="form-check-label" for="cbPolicyOnlyDriver">
                            Is the Policy Holder the only Driver?
                          </label>
                        </div>
                      </div>
                    </div>
    
                    <div class="col-lg-3 col-md-4 col-sm-6">
                      <div class="form-group">
                        <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="cbPolicyOwner"
                            [(ngModel)]="carDetails.cbPolicyOwner" formControlName="cbPolicyOwner">
                          <label class="form-check-label" for="cbPolicyOwner">
                            Is the Policy Holder the Owner?
                          </label>
                        </div>
                      </div>
                    </div>
    
                    <div class="col-lg-3 col-md-4 col-sm-6">
                      <div class="form-group">
                        <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="cbHasAssignee"
                            [(ngModel)]="carDetails.cbHasAssignee" formControlName="cbHasAssignee" (change)="showAssignee = !showAssignee">
                          <label class="form-check-label" for="cbHasAssignee">
                            Has Assignee?
                          </label>
                        </div>
                      </div>
                    </div>
    
                    <div class="form-divider"></div>
    
                    <div class="col-lg-3 col-md-4 col-sm-6">
                      <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['mortgageClause'].invalid 
                      && (quoteForm.controls['mortgageClause'].dirty 
                      || quoteForm.controls['mortgageClause'].touched)}">
                        <div class="form-check">
                          <input class="form-check-input" type="checkbox" id="cbVehicleMortgaged"
                            [(ngModel)]="carDetails.cbVehicleMortgaged" formControlName="cbVehicleMortgaged"
                            (change)="showMortgagee = !showMortgagee">
                          <label class="form-check-label" for="cbVehicleMortgaged">
                            Vehicle Mortgaged
                          </label>
                        </div>
                        <label class="form-check-label" for="mortgageClause">
                          Mortgage Clause
                        </label>
                        <select class="custom-select mr-sm-2 required" formControlName="mortgageClause"
                          [attr.disabled]="carDetails.cbVehicleMortgaged ? null : ''"
                          [(ngModel)]="carDetails.mortgageClause">
                          <option></option>
                          <option *ngFor="let mortgageClause of LOV.mortgageClauseLOV"
                            [ngValue]="mortgageClause.TIP_MORT_CLAUSE">{{ mortgageClause.NOM_VALOR }}</option>
                        </select>
                        <p class="form-error" *ngIf="quoteForm.controls['mortgageClause'].errors?.required">
                          * mortgage clause is required
                        </p>
                      </div>
                    </div>

                  </div>
                </div>

                <div class="form-divider"></div>
                <div class="col-xl-12">
                  <h6>Other Details</h6>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group">
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="cbGlassEtchingEntitled"
                        [(ngModel)]="carDetails.cbGlassEtchingEntitled" formControlName="cbGlassEtchingEntitled">
                      <label class="form-check-label" for="cbGlassEtchingEntitled">
                        Glass Etching Entitled
                      </label>
                    </div>
                    <label class="form-check-label" for="glassEtchingAvailmentDate">
                      Glass Etching Availment Date
                    </label>
                    <input type="text" placeholder="Datepicker" class="form-control required" [minDate]="today"
                      [attr.disabled]="carDetails.cbGlassEtchingEntitled ? null : ''"
                      formControlName="glassEtchingAvailmentDate" [(ngModel)]="carDetails.glassEtchingAvailmentDate"
                      bsDatepicker>
                  </div>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group">
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="cbPrepaidPremium"
                        [(ngModel)]="carDetails.cbPrepaidPremium" formControlName="cbPrepaidPremium">
                      <label class="form-check-label" for="cbPrepaidPremium">
                        Prepaid Premium
                      </label>
                    </div>
                  </div>
                </div>

                <div class="form-divider"></div>
                <div class="col-xl-12">
                  <h6>Inspection Details</h6>
                </div>

                <div class="col-xl-12">
                  <div class="alert alert-info note">
                    <p><strong>Important Reminder:</strong> Only fill up the following details when advised by the
                      UNDERWRITER.
                    </p>
                  </div>
                  <!-- .note -->
                </div>

                <div class="col-md-8">
                  <div class="form-group">
                    <label for="existingDamages">Existing Damages</label>
                    <input type="text" class="form-control" formControlName="existingDamages"
                      formControlName="existingDamages">
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="form-group">
                    <label for="price">Inspection Assessment</label>
                    <select class="custom-select mr-sm-2" formControlName="inspectionAssessment"
                      [(ngModel)]="carDetails.inspectionAssessment">
                      <option selected></option>
                      <option *ngFor="let inspectionAssessment of LOV.inspectionAssessmentLOV"
                        [ngValue]="inspectionAssessment.COD_VALOR">{{ inspectionAssessment.NOM_VALOR }}</option>
                    </select>
                  </div>
                </div>

              </div>
            </div>
          </div>

          <app-policy-holder
            *ngIf="isIssuance && showAssignee"
            [title]="'Assignee Policy Holder Information'"
            [showCreateBtn]="true"
            [details]="carDetails"
            [(policyHolder)]="assigneePolicyHolder"
            [compareTo]="policyHolder"
            [isIssuance]="isIssuance"
            [type]="'assignee'"
            [optional]="false">
          </app-policy-holder>

          <app-policy-holder
            *ngIf="isIssuance && showMortgagee"
            [title]="'Mortgagee Policy Holder Information'"
            [showCreateBtn]="false"
            [details]="carDetails"
            [(policyHolder)]="mortgageePolicyHolder"
            [isIssuance]="isIssuance"
            [type]="'mortgagee'"
            [optional]="false">
          </app-policy-holder>

          <div *ngIf='isIssuance' class="card shadow mb-3">
            <div class="card-header d-flex justify-content-between optional" (click)="showSubAgent = !showSubAgent"
              matTooltip="click to show/hide subagents">
              <strong>Subagent (Optional)</strong>
              <div class="dropdown no-arrow">
                <i class="fas fa-angle-double-down fa-sm fa-fw text-gray-400"></i>
              </div>
            </div>
            <div class="card-body" *ngIf="showSubAgent">
              <div class="row">
                <div class="col-sm-6">
                  <h6>Subagent List</h6>
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['subAgent'].invalid 
                      && (quoteForm.controls['subAgent'].dirty 
                      || quoteForm.controls['subAgent'].touched)}">
                    <ng-select [items]="LOV.subagentLOV" bindLabel="name" placeholder="Select Subagent" appendTo="body"
                      formControlName="subAgent" multiple="true" [(ngModel)]="carDetails.subAgent">
                    </ng-select>
                    <p class="form-error" *ngIf="quoteForm.controls['subAgent'].errors?.required">
                      * subagent is required
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div *ngIf="isIssuance && showCTPL" class="card shadow mb-3" id="CTPLAuth">
            <div class="card-header">
              <strong>CTPL Authenctication (for products with CTPL)</strong>
            </div>

            <div class="card-body">
              <div class="row">
                <div class="col-lg-4 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['automaticAuth'].invalid 
                    && (quoteForm.controls['automaticAuth'].dirty 
                    || quoteForm.controls['automaticAuth'].touched)}">
                    <label for="automaticAuth">Automatic Authentication</label>
                    <select class="custom-select mr-sm-2 required" formControlName="automaticAuth"
                      [(ngModel)]="carDetails.automaticAuth">
                      <option value="S">YES</option>
                      <option value="N">NO</option>
                    </select>
                    <p class="form-error" *ngIf="quoteForm.controls['automaticAuth'].errors?.required">
                      * automatic authentication is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-4 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['registrationType'].invalid 
                    && (quoteForm.controls['registrationType'].dirty 
                    || quoteForm.controls['registrationType'].touched)}">
                    <label for="registrationType">Registration Type</label>
                    <select class="custom-select mr-sm-2 required" formControlName="registrationType"
                      [(ngModel)]="carDetails.registrationType">
                      <option selected></option>
                      <option *ngFor="let rType of LOV.registrationTypeLOV" [ngValue]="rType.COD_VALOR">
                        {{ rType.NOM_VALOR }}</option>
                    </select>
                    <p class="form-error" *ngIf="quoteForm.controls['registrationType'].errors?.required">
                      * registration type is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-4 col-md-4 col-sm-6">
                  <div class="form-group">
                    <label for="mvType">MV Type (leave blank to set default value)</label>
                    <select class="custom-select mr-sm-2" formControlName="mvType" [(ngModel)]="carDetails.mvType">
                      <option selected></option>
                      <option *ngFor="let mv of LOV.mvTypeLOV" [ngValue]="mv.COD_VALOR">{{ mv.NOM_VALOR }}</option>
                    </select>
                  </div>
                </div>

                <div class="col-lg-4 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['cocNumber'].invalid 
                  && (quoteForm.controls['cocNumber'].dirty 
                  || quoteForm.controls['cocNumber'].touched)}">
                    <label for="cocNumber">COC Number</label>
                    <input type="text" formControlName="cocNumber" class="form-control required"
                      [(ngModel)]="carDetails.cocNumber">
                    <p class="form-error" *ngIf="quoteForm.controls['cocNumber'].errors?.required">
                      * coc number is required
                    </p>
                  </div>
                </div>

                <div class="col-sm-8">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['authNumber'].invalid 
                    && (quoteForm.controls['authNumber'].dirty 
                    || quoteForm.controls['authNumber'].touched)}">
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="cbIsNotRequiredAuthNumber"
                        formControlName="cbIsNotRequiredAuthNumber" [(ngModel)]="carDetails.cbIsNotRequiredAuthNumber">
                      <label class="form-check-label" for="cbIsNotRequiredAuthNumber">
                        Do not require Authentication Number
                      </label>
                    </div>
                    <label class="form-check-label" for="cbIsNotRequiredAuthNumber">
                      Authenctication Number (ISAP Authentication)
                    </label>
                    <div class="input-group mb-3">
                      <input type="text" formControlName="authNumber"
                        [attr.disabled]="carDetails.cbIsNotRequiredAuthNumber ? '' : null" class="form-control required"
                        [(ngModel)]="carDetails.authNumber">
                      <div class="input-group-append">
                        <button (click)="authCOCRegistration()" [attr.disabled]="carDetails.cbIsNotRequiredAuthNumber ? '' : null"
                          class="btn btn-primary" type="button">Authenticate</button>
                      </div>
                      <p class="form-error" *ngIf="quoteForm.controls['authNumber'].errors?.required">
                        * authentication number is required
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- cannot use reference variable and ngIf -->
          <app-coverages
            *ngIf="showCoverage"
            [carDetails]="carDetails"
            [(showCTPL)]="showCTPL"
            [quoteForm]="quoteForm"
            [coverageList]="coverageList"
            [coverageVariable]="coverageVariable"
            [amountList]="amountList"
            [premiumAmount]="premiumAmount"
            [coverageAmount]="coverageAmount"
            [coverageVariableData]="coverageVariableData"
            [isModifiedCoverage]="isModifiedCoverage"
            [isIssuance]="isIssuance">
          </app-coverages>

          <app-payment-breakdown
            *ngIf="showPaymentBreakdown"
            #appPaymentBreakdown
            [paymentReceipt]="paymentReceipt"
            [paymentBreakdown]="paymentBreakdown"
            [showExchangeRate]="false">
          </app-payment-breakdown>

          <div class="card shadow mb-3">
            <div class="card-header">
              <strong>Product</strong>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-xl-12">
                  <h6>Product Data</h6>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['paymentMethod'].invalid 
                        && (quoteForm.controls['paymentMethod'].dirty 
                        || quoteForm.controls['paymentMethod'].touched)}">
                    <label for="paymentMethod">Payment Method</label>
                    <select class="custom-select mr-sm-2 required" formControlName="paymentMethod"
                      [(ngModel)]="carDetails.paymentMethod" [attr.disabled]=" !carDetails.subline ? true : null">
                      <option selected></option>
                      <option *ngFor="let paymentMethod of LOV.paymentMethodLOV"
                        [ngValue]="paymentMethod.COD_FRACC_PAGO">
                        {{ paymentMethod.NOM_FRACC_PAGO }}</option>
                    </select>
                    <p class="form-error" *ngIf="quoteForm.controls['paymentMethod'].errors?.required">
                      * payment method is required
                    </p>
                  </div>
                </div>

                <div class="col-lg-3 col-md-4 col-sm-6">
                  <div class="form-group" [ngClass]="{'input-error': quoteForm.controls['product'].invalid 
                        && (quoteForm.controls['product'].dirty 
                        || quoteForm.controls['product'].touched)}">
                    <label for="product">Product List</label>
                    <select class="custom-select mr-sm-2 required" formControlName="product"
                      [attr.disabled]="showGenerateBtnGrp && !isModifiedCoverage ? null : true"
                      [(ngModel)]="carDetails.productList" [attr.disabled]=" LOV.productListLOV?.length ? null : true"
                      (change)="productOnChange()">
                      <option selected></option>
                      <option *ngFor="let product of LOV.productListLOV" [ngValue]="product.COD_MODALIDAD">
                        {{ product.NOM_MODALIDAD }}
                      </option>
                    </select>
                    <p class="form-error" *ngIf="quoteForm.controls['product'].errors?.required">
                      * product list is required
                    </p>
                  </div>
                </div>

              </div>
            </div>
          </div>

          <div class="alert alert-info note">
            <p>
              <strong>Important Reminder:</strong> Please make sure to fill out all required fields to enable the {{isIssuance ? 'save' : 'generate'}} button.
            </p>
          </div>
          <!-- .note -->

          <div *ngIf="secondaryPolicyHolder.documentCode != undefined && secondaryPolicyHolder.documentCode != '' && carDetails.secondaryPolicyHolderSeparator == undefined" class="alert alert-warning note">
            <p>
              <strong>Required:</strong> You need to fill out Alternative Policy holder <strong>Separator</strong>.
              Scroll to <button class="btn btn-warning" (click)="scrollTo('secondary_panel')">Alternative</button>
            </p>
          </div>
          <!-- .note -->

          <div *ngIf="carDetails.cbHasAssignee && (assigneePolicyHolder.documentCode == undefined || assigneePolicyHolder.documentCode == '')" class="alert alert-warning note">
            <p>
              <strong>Required:</strong> You are required to add <strong>Assignee</strong>.
              Scroll to <button class="btn btn-warning" (click)="scrollTo('assignee_panel')">Assignee</button>
            </p>
          </div>
          <!-- .note -->

          <div *ngIf="carDetails.cbVehicleMortgaged && (mortgageePolicyHolder.documentCode == undefined || mortgageePolicyHolder.documentCode == '')" class="alert alert-warning note">
            <p>
              <strong>Required:</strong> You are required to add <strong>Mortgagee</strong>. 
              Scroll to <button class="btn btn-warning" (click)="scrollTo('mortgagee_panel')">Mortgagee</button>
            </p>
          </div>
          <!-- .note -->

          <!-- button controls for quotation -->
          <div *ngIf="!isIssuance && showGenerateBtnGrp" class="btn-group" role="group">
            <button
              [disabled]="quoteForm.pristine || quoteForm.invalid ||
              appGroupPolicy.gpForm.pristine || appGroupPolicy.gpForm.invalid ||
              appPolicyHolder.phForm.pristine || appPolicyHolder.phForm.invalid"
              type="button" class="btn btn-primary"
              (click)="issueQuote('S')">Generate</button>
          </div>

          <div *ngIf="!isIssuance && showIssueQuoteBtnGrp" class="btn-group" role="group">
            <button type="button" class="btn btn-primary"
              (click)="manageBtn(1, false)">Change Product</button>
            <button type="button" class="btn btn-primary"
              (click)="manageBtn(4, false)">Edit Coverage</button>
            <button
              [disabled]="quoteForm.pristine || quoteForm.invalid ||
              appGroupPolicy.gpForm.pristine || appGroupPolicy.gpForm.invalid ||
              appPolicyHolder.phForm.pristine || appPolicyHolder.phForm.invalid"
              type="button" class="btn btn-primary"
              (click)="issueQuote('N')">Issue Qoute</button>
          </div>

          <div *ngIf="!isIssuance && showProceedToIssuanceBtnGrp" class="text-right">
            <h5><small>Your quotation number:</small> {{carDetails.quotationNumber}}</h5>
          </div>
          <div *ngIf="!isIssuance && showProceedToIssuanceBtnGrp" class="btn-group" role="group">
            <button type="button" (click)="newQuote()" class="btn btn-primary">New Quote</button>
            <button type="button" (click)="printQuote()" class="btn btn-primary">Print Qoute</button>
            <button type="button" (click)="proceedToIssuance()" class="btn btn-primary">Proceed to Issuance</button>
          </div>

          <!-- button controls for issuance -->
          <div *ngIf="isIssuance && showSaveBtn" class="btn-group" role="group">
            <!-- <button type="button" class="btn btn-primary"
            (click)="test(appGroupPolicy, appPolicyHolder)">test</button>-->
            <button 
              [disabled]="quoteForm.pristine || quoteForm.invalid ||
              appGroupPolicy.gpForm.pristine || appGroupPolicy.gpForm.invalid ||
              appPolicyHolder.phForm.pristine || appPolicyHolder.phForm.invalid ||
              (secondaryPolicyHolder.documentCode != undefined && secondaryPolicyHolder.documentCode != '' && carDetails.secondaryPolicyHolderSeparator == undefined) ||
              (carDetails.cbHasAssignee && (assigneePolicyHolder.documentCode == undefined || assigneePolicyHolder.documentCode == '')) ||
              (carDetails.cbVehicleMortgaged && (mortgageePolicyHolder.documentCode == undefined || mortgageePolicyHolder.documentCode == ''))"
              type="button" class="btn btn-primary"
              (click)="savePolicy()">Save</button>
          </div>

          <div *ngIf="isIssuance && showPostBtn" class="btn-group" role="group">
            <button
              [disabled]="quoteForm.pristine || quoteForm.invalid ||
              appGroupPolicy.gpForm.pristine || appGroupPolicy.gpForm.invalid ||
              appPolicyHolder.phForm.pristine || appPolicyHolder.phForm.invalid ||
              (secondaryPolicyHolder.documentCode != undefined && secondaryPolicyHolder.documentCode != '' && carDetails.secondaryPolicyHolderSeparator == undefined) ||
              (carDetails.cbHasAssignee && (assigneePolicyHolder.documentCode == undefined || assigneePolicyHolder.documentCode == '')) ||
              (carDetails.cbVehicleMortgaged && (mortgageePolicyHolder.documentCode == undefined || mortgageePolicyHolder.documentCode == ''))"
              type="button" class="btn btn-primary"
              (click)="postPolicy()">Post</button>
          </div>

          <div *ngIf="isIssuance && showPrintBtn" class="btn-group" role="group">
            <button
              [disabled]="quoteForm.pristine || quoteForm.invalid ||
              appGroupPolicy.gpForm.pristine || appGroupPolicy.gpForm.invalid ||
              appPolicyHolder.phForm.pristine || appPolicyHolder.phForm.invalid"
              type="button" class="btn btn-primary"
              (click)="issueQuote('S')">Print</button>
          </div>

        </form>
        <!-- .regular-quote-form -->
      </div>
      <!-- .card-body -->
    </div>
    <!-- .card.shadow -->
  </div>
  <!-- .col-xl-12 -->
</div>
<!-- #quotationCar -->
